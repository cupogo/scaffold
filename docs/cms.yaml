
depends:
  comm: 'hyyl.xyz/cupola/andvari/models/comm'
  oid: 'hyyl.xyz/cupola/andvari/models/oid'

modelpkg: cms1
models:
  - name: Article
    comment: '文章'
    tableTag: 'cms_article,alias:a'
    fields:
      - name: comm.DefaultModel
      - comment: 作者
        name: Author
        type: string
        tags: {json: 'author', pg: ',notnull,use_zero'}
        isset: true
        query: 'ice' # '', 'equal', 'match'
      - comment: 标题
        name: Title
        type: string
        tags: {json: 'title', pg: ',notnull'}
        isset: true
        query: 'fts' # '', 'equal', 'match'
      - comment: 内容
        name: Content
        type: string
        tags: {json: 'content', pg: ',notnull'}
        isset: true
        query: 'fts'
      - comment: '新闻时间'
        name: NewsPublish
        type: comm.DateTime
        tags: {json: 'newsPublish,omitempty', pg: "news_publish,type:date"}
        isset: true
        query: 'date'
      - comment: 状态
        name: Status
        type: int16
        tags: {json: 'status', pg: ',notnull,use_zero'}
        isset: true
        query: 'equal,ints'
      - type: comm.MetaField
      - type: comm.TextSearchField
    oidcat: article
    hooks:
      beforeSaving: dbBeforeSaveArticle
      afterDeleting: dbAfterDeleteArticle

  - name: Clause
    comment: '条款'
    tableTag: 'cms_clause,alias:c'
    fields:
      - name: comm.DefaultModel
      - name: Text
        type: string
        tags:
          json: 'text'
          pg: 'text,notnull'
        isset: true
        query: 'match'
    oidcat: article

stores:
  - name: contentStore
    hodBread: [ Article ]
    methods:
      - name: ListClause
      - name: GetClause
      - name: PutClause
        simple: true
      - name: DeleteClause

webapi:
  pkg: api_v1
  uris:
    - model: Article
      prefix: '/api/v1/cms'
  handles:
    - name: getCmsClause
      store: Content
      method: GetClause
      summary: 获取内容条款
      route: '/api/v1/cms/clauses/{id} [get]'
      needAuth: true
    - name: putCmsClause
      store: Content
      method: PutClause
      bindobj: cms1.ClauseSet
      summary: 录入内容条款
      route: '/api/v1/cms/clauses/{id} [put]'
      needAuth: true
      needPerm: true
    - name: getCmsClauses
      store: Content
      method: ListClause
      bindobj: stores.ClauseSpec
      summary: 列出内容条款
      route: '/api/v1/cms/clauses [get]'
      needAuth: true
    - name: deleteCmsClause
      store: Content
      method: DeleteClause
      summary: 删除内容条款
      route: '/api/v1/cms/clauses/{id} [delete]'
      needAuth: true
      needPerm: true
